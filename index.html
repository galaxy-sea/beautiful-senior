<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="description" content="Hover Slide Effect with jQuery"/>
    <meta name="keywords" content="jquery, slide, hover, effect, animation, fancy, entry page, fade in"/>

    <link rel="stylesheet" href="css/style.css" type="text/css" media="screen"/>

    <script src="https://cdn.bootcss.com/cufon/1.09i/cufon-yui.min.js" type="text/javascript"></script>
    <script src="https://cdn.bootcss.com/jquery/1.7.2/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-easing/1.3/jquery.easing.min.js"></script>

    <!--  网页title的特效  -->
    <title>林三碗的漂亮写真</title>
    <meta name="viewport" content="width=device-width"/>
    <link rel="shortcut icon" href="./images/favicon.ico">
    <script>
        window.onload = function () {
            var OriginTitile = document.title;
            var titleTime;
            document.addEventListener('visibilitychange', function () {
                if (document.hidden) {
                    $('[rel="shortcut icon"]').attr('href', "./images/failure.ico");
                    document.title = '(●—●)喔哟，崩溃啦！';
                    clearTimeout(titleTime);
                } else {
                    $('[rel="shortcut icon"]').attr('href', "./images/favicon.ico");
                    document.title = '(/≧▽≦/)咦！又好了！' + OriginTitile;
                    titleTime = setTimeout(function () {
                        document.title = OriginTitile;
                    }, 2000);
                }
            });
        }
    </script>
    <!--  网页title的特效  -->

    <style type="text/css">
        .div-1920-1080 {
            background-color: red;
            position: absolute;
            left: 0px;
            top: 0px;
            width: 1920px;
            height: 1080px;
            /*z-index: 1;*/
        }

        .div-1440-900 {
            background-color: green;
            position: absolute;
            left: 0px;
            top: 0px;
            width: 1440px;
            height: 900px;
            /*z-index: 2;*/
        }
    </style>
</head>

<body>
<div class="div-1920-1080"></div>
<div class="div-1440-900"></div>
<div class="content">
    <div id="hs_container" class="hs_container">
        <div class="hs_area hs_area1"></div>
        <div class="hs_area hs_area2"></div>
        <div class="hs_area hs_area3"></div>
        <div class="hs_area hs_area4"></div>
        <div class="hs_area hs_area5"></div>
    </div>


</div>


<!-- The JavaScript -->
<script type="text/javascript">
    var imgSrcJsonArray = ["images/album/1.jpg", "images/album/2.jpg", "images/album/3.jpg", "images/album/4.jpg", "images/album/5.jpg", "images/album/6.jpg", "images/album/7.jpg", "images/album/8.jpg", "images/album/9.jpg", "images/album/10.jpg",
        "images/album/11.jpg", "images/album/12.jpg", "images/album/13.jpg", "images/album/14.jpg", "images/album/15.jpg", "images/album/16.jpg", "images/album/17.jpg", "1images/album/8.jpg"
    ];

    $(function () {
        chaosSequence();
        imgAnimation();
    });


    function chaosSequence() {
        var $hs_areas = $('.hs_area');
        var divMap = divChaosSequence($hs_areas);
        divAddImg(divMap);
    }

    // todo 需要修改图片加载方式, 使用回调
    function divAddImg(divMap) {
        var set = new Set();
        imgSrcJsonArray.forEach(value => {
            var image = new Image();
            image.src = value;
            image.onload = function () {
                var widthAndHeight = this.width + ':' + this.height;
                if (divMap.has(widthAndHeight)) {
                    var flag = true;
                    divMap.get(widthAndHeight).forEach($div => {
                        var $image = $(this);
                        if (!set.has($div)) {
                            set.add($div);
                            image.className = 'hs_visible';
                        }
                        if (flag) {
                            $image = $image.clone();
                            flag = false;
                        }
                        $div.append($image);
                    });
                }
            }
        });
    }

    function divChaosSequence($hs_areas) {
        var divMap = new Map();
        $hs_areas.each(function () {
            var widthAndHeight = $(this).css("width").toLowerCase().replace('px', '') + ':' + $(this).css("height").toLowerCase().replace('px', '');
            var array = new Array();
            if (divMap.has(widthAndHeight)) {
                array = divMap.get(widthAndHeight);
            } else {
                divMap.set(widthAndHeight, array);
            }
            array.push($(this));
        });
        return divMap;
    }


    function imgAnimation() {
        //caching
        var $hs_container = $('#hs_container');
        var $hs_areas = $hs_container.find('.hs_area');

        $hs_areas.each(function () {
            var $area = $(this);
            //when the mouse enters the area we animate the current
            //image (random animation from array animations),
            //so that the next one gets visible.
            //"over" is a flag indicating if we can animate
            //an area or not (we don't want 2 animations
            //at the same time for each area)
            $area.data('over', true).bind('mouseenter', function () {
                if ($area.data('over')) {
                    $area.data('over', false);
                    //visible image
                    var $current = $area.find('img:visible');
                    //the next image that's going to be displayed.
                    //either the next one, or the first one if the current is the last
                    // var $next = (idx_current == total - 1) ? $area.children(':first') : $current.next();

                    // random the next image that's going to be displayed.
                    var $next = randomNext($area, $current);
                    if ($next != null) {
                        //show next one (not yet visible)
                        $next.show();
                        //get a random animation
                        randomAnimation($current, $next, $area);
                    }
                }
            });
        });

        //when clicking the hs_container all areas get slided
        //(just for fun...you would probably want to enter the site
        //or something similar)
        $hs_container.bind('click', function () {
            $hs_areas.trigger('mouseenter');
        });
    }


    // random the next image that's going to be displayed.
    function randomNext($area, $current) {
        //how many images in this area?
        var total = $area.children().length;
        if (total <= 1) {
            return null;
        }
        //index of visible image
        var idx_current = $current.index();
        do {
            var inx_floor = Math.floor(Math.random() * total)
        } while (inx_floor == idx_current);
        return $area.children(':eq(' + inx_floor + ')');
    }


    //custom animations to use
    //in the transitions
    var animations = ['right', 'left', 'top', 'bottom', 'rightFade', 'leftFade', 'topFade', 'bottomFade'];
    var total_anim = animations.length;
    //just change this to one of your choice
    var easeType = 'swing';

    //the speed of each transition
    var animSpeed = 450;

    //random animation
    function randomAnimation($current, $next, $area) {
        var anim = animations[Math.floor(Math.random() * total_anim)];
        switch (anim) {
            //current slides out from the right
            case 'right':
                $current.animate({
                        'left': $current.width() + 'px'
                    },
                    animSpeed,
                    easeType,
                    function () {
                        $current.hide().css({
                            'z-index': '1',
                            'left': '0px'
                        });
                        $next.css('z-index', '9999');
                        $area.data('over', true);
                    });
                break;
            //current slides out from the left
            case 'left':
                $current.animate({
                        'left': -$current.width() + 'px'
                    },
                    animSpeed,
                    easeType,
                    function () {
                        $current.hide().css({
                            'z-index': '1',
                            'left': '0px'
                        });
                        $next.css('z-index', '9999');
                        $area.data('over', true);
                    });
                break;
            //current slides out from the top
            case 'top':
                $current.animate({
                        'top': -$current.height() + 'px'
                    },
                    animSpeed,
                    easeType,
                    function () {
                        $current.hide().css({
                            'z-index': '1',
                            'top': '0px'
                        });
                        $next.css('z-index', '9999');
                        $area.data('over', true);
                    });
                break;
            //current slides out from the bottom
            case 'bottom':
                $current.animate({
                        'top': $current.height() + 'px'
                    },
                    animSpeed,
                    easeType,
                    function () {
                        $current.hide().css({
                            'z-index': '1',
                            'top': '0px'
                        });
                        $next.css('z-index', '9999');
                        $area.data('over', true);
                    });
                break;
            //current slides out from the right	and fades out
            case 'rightFade':
                $current.animate({
                        'left': $current.width() + 'px',
                        'opacity': '0'
                    },
                    animSpeed,
                    easeType,
                    function () {
                        $current.hide().css({
                            'z-index': '1',
                            'left': '0px',
                            'opacity': '1'
                        });
                        $next.css('z-index', '9999');
                        $area.data('over', true);
                    });
                break;
            //current slides out from the left and fades out
            case 'leftFade':
                $current.animate({
                        'left': -$current.width() + 'px', 'opacity': '0'
                    },
                    animSpeed,
                    easeType,
                    function () {
                        $current.hide().css({
                            'z-index': '1',
                            'left': '0px',
                            'opacity': '1'
                        });
                        $next.css('z-index', '9999');
                        $area.data('over', true);
                    });
                break;
            //current slides out from the top and fades out
            case 'topFade':
                $current.animate({
                        'top': -$current.height() + 'px',
                        'opacity': '0'
                    },
                    animSpeed,
                    easeType,
                    function () {
                        $current.hide().css({
                            'z-index': '1',
                            'top': '0px',
                            'opacity': '1'
                        });
                        $next.css('z-index', '9999');
                        $area.data('over', true);
                    });
                break;
            //current slides out from the bottom and fades out
            case 'bottomFade':
                $current.animate({
                        'top': $current.height() + 'px',
                        'opacity': '0'
                    },
                    animSpeed,
                    easeType,
                    function () {
                        $current.hide().css({
                            'z-index': '1',
                            'top': '0px',
                            'opacity': '1'
                        });
                        $next.css('z-index', '9999');
                        $area.data('over', true);
                    });
                break;
            default:
                $current.animate({
                        'left': -$current.width() + 'px'
                    },
                    animSpeed,
                    easeType,
                    function () {
                        $current.hide().css({
                            'z-index': '1',
                            'left': '0px'
                        });
                        $next.css('z-index', '9999');
                        $area.data('over', true);
                    });
                break;
        }
    }

    function commonDivisor(num1, num2) {
        if ((num1 - num2) < 0) {
            var data = num1;
            num1 = num2;
            num2 = data;
        }
        while (num2 != 0) {
            var remainder = num1 % num2;
            num1 = num2;
            num2 = remainder;
        }
        return num1;
    }
</script>
</body>

</html>